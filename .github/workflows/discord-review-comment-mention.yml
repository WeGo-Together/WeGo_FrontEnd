name: Discord PR Review Notification

on:
  pull_request_review:
    types: [submitted]

jobs:
  notify:
    runs-on: ubuntu-latest
    # approved ë˜ëŠ” changes_requestedë§Œ ì²˜ë¦¬
    if: |
      github.event.review.state == 'approved' || 
      github.event.review.state == 'changes_requested'
    steps:
      - name: Send Discord notification
        uses: actions/github-script@v7
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          script: |
            const discordIdMap = {
              'yoorli': '1252243063066067057',
              'HopeFullee': '215837654808264704',
              'claudia99503': 1196405542751571979',
              'Chiman2937': '472760360932474921',
              'wooktori': '410687167329992714'
            };

            const prAuthor = context.payload.pull_request.user.login;
            const reviewer = context.payload.review.user.login;
            const reviewState = context.payload.review.state;
            const prNumber = context.payload.pull_request.number;
            const prTitle = context.payload.pull_request.title;
            const reviewUrl = context.payload.review.html_url;

            const authorDiscordId = discordIdMap[prAuthor];
            const mention = authorDiscordId ? `<@${authorDiscordId}>` : '@here';

            // ë¦¬ë·° ìƒíƒœì— ë”°ë¥¸ ë©”ì‹œì§€
            const statusEmoji = reviewState === 'approved' ? 'âœ…' : 'ğŸ”„';
            const statusText = reviewState === 'approved' ? 'ìŠ¹ì¸' : 'ë³€ê²½ ìš”ì²­';
            const color = reviewState === 'approved' ? 5763719 : 15158332;

            const payload = {
              content: `${mention} **${reviewer}**ë‹˜ì´ [PR #${prNumber}: ${prTitle}](${reviewUrl})ì„ ${statusEmoji} **${statusText}**í–ˆìŠµë‹ˆë‹¤.`,
              embeds: [{
                color: color
              }]
            };

            await fetch(process.env.DISCORD_WEBHOOK, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
